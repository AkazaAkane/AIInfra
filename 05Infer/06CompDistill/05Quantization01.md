# 大模型量化：低精度量化

模型量化是一种参数压缩与加速技术，其核心逻辑是将模型中的高精度浮点数（如32位浮点数 FP32）转换为低精度整数（如8位整数 INT8 或4位整数 INT4），从而减少存储空间、提升推理速度并降低硬件能耗。 一个拥有70B（700亿）参数的模型，如果用FP32存储，需要 70B * 4字节 = 280 GB 的内存。将FP32转换为INT8，模型大小直接降为 70B * 1字节 = 70 GB；转换为INT4，则仅为 35 GB。这使得大模型能够在更广泛的硬件上运行。在推理过程中，巨大的模型参数也需要从GPU的显存中读取到计算核心（如CUDA Cores）中进行计算。内存带宽（如几百GB/s）相比计算速度而言是一个更稀缺的资源，经常成为性能瓶颈。更小的数据体积意味着在相同的带宽下，每秒可以传输更多的参数。这极大地缓解了带宽压力，从而提升推理速度。此外，使用INT8/INT4等整数格式，硬件可以在一个时钟周期内执行更多的操作（例如，一次INT8运算能处理比FP32多4倍的数据）。

## 数值格式结构对比

| 格式 | 总位数 | 符号位 (S) | 指数位 (E) | 尾数/小数位 (M) | 数值范围 (近似) | 内存占用 (相对于 FP32) | 主要用途与特点 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **FP32** | 32 bits | 1 bit | 8 bits | 23 bits | ±3.4 × 10³⁸ | 1x (基准) | 高精度计算，训练和推理的基准格式 |
| **BF16** | 16 bits | 1 bit | **8 bits** | **7 bits** | ±3.4 × 10³⁸ | **50%** | 训练加速，动态范围大，混合精度训练核心 |
| **INT8** | 8 bits | 1 bit | **无** | **7 bits (有效)** | -128 to 127 | **25%** | 推理加速，最常用的量化格式，效率与精度平衡 |
| **INT4** | 4 bits | 1 bit | **无** | **3 bits (有效)** | -8 to 7 | **12.5%** | 模型压缩，用于资源受限场景，需复杂量化技术 |

FP32是标准的单精度浮点数，是原始LLM模型权重和激活值的默认格式。浮点数FP的结构包含符号位 (Sign)、指数位 (Exponent) 和尾数位 (Mantissa/Fraction) 三部分。FP32的结构为：S(1) | E(8) | M(23)，其计算最精确，但计算速度和内存效率最低。

BF16指数位与FP32保持一致（8位），但大幅削减了尾数位（只有7位）。其结构为：S(1) | E(8) | M(7)。在混合精度训练中，前向和反向传播使用BF16，以减少内存占用和加速计算，而权重更新等关键操作仍可能使用FP32来保持数值稳定性。它本身也是一种“量化”形式(从FP32到BF16)，但通常不归入“低比特量化”的讨论范畴，后者特指INT8/INT4。

整数INT用于表示离散的整数值。其设计目的是精确存储整数，没有小数部分。结构通常只包含符号位(Sign)和数值位(Value)。INT8是非常流行的推理后量化格式，其结构为：S(1) | Value(7)。由于整数格式无法直接表示小数。为了用INT8来表示原本是浮点数的权重和激活值，需要引入量化参数(Scale, 有时还有Zero Point)。INT8量化可以将模型大小减少至原来的1/4，并显著提升推理速度（因为整数运算比浮点运算快得多）。通常会导致极小的精度损失，对于许多任务来说是可接受的。

INT4的结构为：S(1) | Value(3) 或使用更高级的编排方式（如GPTQ）。INT4量化后的每个参数只有16种可能的取值(-8到7)，其数值范围非常有限，精度损失风险极大。直接使用常规INT4量化会导致模型性能严重下降，在LLM中应用时通常需要更复杂的量化技术来弥补精度损失。

## 量化过程

模型量化的本质是通过数学映射，在精度损失可控的前提下，将模型参数从“高精度”转换为“低精度”，实现性能与效率的平衡。量化过程为：

1.确定数值的动态范围：要搞清楚数据中数值的变化范围。
2.选择缩放因子（Δ）：这个因子很关键，会影响量化的效果。
3.将浮点值映射为整数：按照规则把浮点形式的数字变成整数。
4.存储缩放因子用于反量化：方便之后把量化后的整数再变回浮点值。

## Int8量化
### 计算过程

### 适用阶段及策略


## Int4量化
### 计算过程

### 适用阶段及策略


## 混合精度量化
### 计算过程

### 适用阶段及策略
